<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BBB Golf</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon.png" />
  <meta id="cacheBuster" name="version" content="20251123">

  <style>
    /* === GLOBAL: NO TOP GAP + SAFE PADDING === */
 /* Enable full scroll + safe area */
html, body {
  margin: 0;
  padding: 0;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  scroll-padding-top: env(safe-area-inset-top, 0px);
  -webkit-overflow-scrolling: touch;
}

body {
  position: static;
  overscroll-behavior-y: contain;
  padding-top: env(safe-area-inset-top, 0px);
}


    :root {
      --bg: #f4f4f4;
      --card: #fff;
      --text: #222;
      --green: #0f0;
      --btn-bg: #0f0;
      --btn-text: #000;
      --table-header: #555;
      --table-bg: #eee;
    }
    [data-theme="dark"] {
      --bg: #111;
      --card: #222;
      --text: #eee;
      --green: #0f0;
      --btn-bg: #0f0;
      --btn-text: #000;
      --table-header: #444;
      --table-bg: #333;
    }

    * { box-sizing: border-box; }

    body {
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  scroll-padding-top: env(safe-area-inset-top, 0px);
  -webkit-overflow-scrolling: touch;
}

    .card {
  background: var(--card);
  padding: 1rem;
  border-radius: 12px;
  margin: 0 auto 1rem;
  max-width: 800px;
  width: 100%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* FIX EMPTY SPACE ON MOBILE — PLAYER SETUP & GAME SCREEN */
#playerSetup,
#game {
  padding-top: 0.3rem !important;
  min-height: auto !important;
}

#playerSetup > div,
#game > div:first-child {
  margin-top: 0.2rem !important;
}




    #courseSetup, #playerSetup, #game, #summary {
      display: flex;
      flex-direction: column;
    }

    h1 { 
      color: var(--green); 
      text-align: center; 
      margin: 0.5rem 0; 
      font-size: 1.4rem; 
    }

    button {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin: 0.25rem;
    }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    
    .hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }

    .center-block { 
      max-width: 800px; 
      margin: 0 auto; 
      width: 100%; 
    }

    #holeDisplay {
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
      margin: 0.5rem 0;
    }

    #scoreTable { 
      width: 100%; 
      max-width: 800px; 
      margin: 0.5rem auto; 
      border-collapse: collapse; 
    }
    #scoreTable th, #scoreTable td { 
      padding: 0.75rem; 
      text-align: center; 
      border-bottom: 1px solid #ddd; 
    }
    #scoreTable th { 
      background: var(--table-header); 
      color: #fff; 
      font-weight: 600; 
    }
    #scoreTable th:first-child, #scoreTable td:first-child { text-align: left; }
    tbody tr:nth-child(even) { background: var(--table-bg); }

    /* === CHECKBOXES: FINAL VERSION (NO DUPLICATES) === */
    input[type="checkbox"] {
      width: 28px;
      height: 28px;
      transform: scale(1.6);
      margin: 0 6px;
      cursor: pointer;
    }

  





 /* GROK: Final game screen spacing — tight top, comfy bottom */
#game {
  padding: 0.4rem 0 1.5rem 0 !important;  /* Top reduced, bottom preserved for control bar */
}



    /* === COURSE SETUP (ONLY ONCE) === */
    #courseSetup {
      padding: 1rem !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: stretch !important;
    }
    #courseSetup > div {
      display: flex !important;
      flex-direction: column !important;
      gap: 0.5rem !important;
      align-items: center !important;
    }
    #courseSelect, #addCourse, #nextToPlayers {
      width: 100% !important;
      max-width: none !important;
      font-size: 1rem !important;
      padding: 0.75rem !important;
    }
    #nextToPlayers:disabled {
      opacity: 0.4 !important;
      background: #ccc !important;
      cursor: not-allowed !important;
    }

    /* PLAYER SETUP & START ROUND */
    #playerSetup {
      padding: 1rem 1rem 160px 1rem !important;
      overflow: visible !important;
    }

    #playerSetup > div[style*="margin-top: 1rem"] {
      margin-top: 1.5rem !important;
      padding: 0.5rem !important;
      background: var(--card) !important;
      border-radius: 8px !important;
      display: block !important;
      width: 100% !important;
      box-sizing: border-box !important;
    }

    #startGame {
      width: 100% !important;
      max-width: none !important;
      padding: 1.2rem !important;
      font-size: 1.2rem !important;
      min-height: 60px !important;
      background: var(--btn-bg) !important;
      color: var(--btn-text) !important;
      border: none !important;
      border-radius: 12px !important;
      font-weight: bold !important;
      cursor: pointer !important;
      box-sizing: border-box !important;
    }
    #startGame:disabled {
      opacity: 0.6 !important;
      background: #ccc !important;
      color: #999 !important;
      cursor: not-allowed !important;
    }

    .holeSummary,
#roundSummary {
  margin: 0.4rem auto !important;
  padding: 0.4rem !important;
  line-height: 1.3 !important;
  font-size: 0.88rem !important;   /* ← was 0.82rem — now matches round summary */
  font-weight: 600 !important;
  text-align: center;
  background: #fff !important;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  border: 1px solid #d4edda;
  max-width: 800px;
}

.holeSummary {
  color: #dc3545 !important;
}

#roundSummary {
  color: #dc3545 !important;
}

    #roundSummary small { 
      color: #a00 !important;
      font-weight: normal;
      font-size: 0.76rem !important;
    }

    /* ONE-LINE TIGHT LAYOUT */
    .holeSummary > div,
    .summary-awarded,
    .summary-carry-in,
    .summary-no-carry {
      margin: 0 !important;
      padding: 0 !important;
      font-size: 0.78rem !important;
      line-height: 1.2 !important;
    }

    .audit-good { color: #0f0; } 
    .audit-bad { color: #f00; }
    .audit-line { margin-top: 0.5rem; font-size: 0.85rem; line-height: 1.5; }
    .history-item { background: var(--card); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px; cursor: pointer; }
    .player-tag { display: inline-block; background: #0f0; color: #000; padding: 0.25rem 0.5rem; border-radius: 6px; margin: 0.25rem; font-size: 0.85rem; }

   

#bbbHelpBtn {
  transition: color 0.2s;
}
#bbbHelpBtn:hover, #bbbHelpBtn:focus {
  color: #090;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ABSOLUTE FINAL KILL ALL TOP SPACE — PLAYER SETUP & GAME */
#playerSetup,
#game {
  padding-top: 0 !important;
  margin-top: 0 !important;
}

#playerSetup > *,
#game > * {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* Kill specific inline-style offenders */
#playerSetup > div[style*="margin-top"],
#game > div[style*="margin-top"],
#game > div[style*="display:flex"] {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* Tighten the hole header and table */
#holeDisplay {
  margin: 0.4rem 0 0.2rem 0 !important;
  padding: 0 !important;
}

#scoreTable {
  margin-top: 0.3rem !important;
}



/* FINAL CONTROL BAR — SMALLER, SUBTLE, CENTERED */
.control-bar {
  padding: 0.6rem 0.4rem !important;
  gap: 0.6rem !important;
  display: flex !important;
  flex-wrap: wrap !important;
  justify-content: flex-start !important;   /* ← changed from center */
  align-items: center !important;
  background: var(--card) !important;
  border-top: 1px solid rgba(0,0,0,0.1);
}

.control-bar button {
  min-width: 64px !important;      /* smaller than before */
  height: 38px !important;         /* shorter */
  padding: 0 0.6rem !important;
  font-size: 0.8rem !important;    /* slightly smaller text */
  font-weight: bold !important;
  border-radius: 10px !important;
  background: #00cc00 !important; /* slightly darker/muted green so it doesn’t scream */
  color: #000 !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

/* PLAYER SELECT — TWO-COLUMN GRID (perfect on every phone) */
#playerSelect {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.8rem 1rem;
  max-width: 700px;
  margin: 0 auto;
  padding: 0 1rem;
}

#playerSelect label {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-size: 1.1rem;
  white-space: nowrap;
  overflow: hidden;
}

/* Bigger checkboxes on phone */
@media (max-width: 768px) {
  #playerSelect {
    grid-template-columns: 1fr 1fr;   /* forces exactly 2 columns on phone */
    gap: 0.9rem 1rem;
    padding: 0 1.5rem;
  }
  #playerSelect input[type="checkbox"] {
    width: 24px !important;
    height: 24px !important;
    transform: scale(1.3) !important;
  }
}


/* FINAL — SCORING TABLE ALWAYS AT THE TOP, NO EMPTY SPACE */
#game {
  padding-top: 0.2rem !important;
  padding-bottom: 1rem !important;
}

/* Kill every possible top margin/padding above the table */
#scoreTable */
#game > div:first-child,
#holeDisplay,
#scoreTable {
  margin-top: 0 !important;
  margin-bottom: 0.4rem !important;
  padding-top: 0 !important;
}

/* Make sure the table itself starts immediately */
#scoreTable {
  margin-top: 0.6rem !important;
}

/* Mobile insurance */
@media (max-width: 768px) {
  #game {
    padding: 0.2rem 0.6rem 1rem !important;
  }
  #holeDisplay {
    margin: 0.2rem 0 0.4rem 0 !important;
  }
}


/* CHECKBOXES — 50% SMALLER ON PHONE ONLY */
@media (max-width: 768px) {
  input[type="checkbox"] {
    width: 18px !important;     /* was ~28px → now 18px */
    height: 18px !important;
    transform: scale(1) !important;   /* removes the 1.6 scale */
    margin: 0 6px !important;
  }
}

/* Optional: make them a touch bigger on PC for mouse users */
@media (min-width: 769px) {
  input[type="checkbox"] {
    width: 22px !important;
    height: 22px !important;
    transform: scale(1.2) !important;
  }
}

/* FINAL — SCORING TABLE FITS EVERY PHONE, TOT ALWAYS VISIBLE */
#scoreTable {
  table-layout: fixed;            /* forces columns to respect widths */
  width: 100% !important;
  margin-top: 0.4rem !important;
}

#scoreTable th:nth-child(1),     /* Player name */
#scoreTable td:nth-child(1) {
  width: 28% !important;         /* gives names plenty of room */
  text-align: left !important;
  padding-left: 0.6rem !important;
}

#scoreTable th:nth-child(2),     /* FO/GR */
#scoreTable td:nth-child(2),
#scoreTable th:nth-child(3),     /* CL */
#scoreTable td:nth-child(3),
#scoreTable th:nth-child(4),     /* P */
#scoreTable td:nth-child(4) {
  width: 12% !important;         /* tiny columns for the 3 checkboxes */
}

#scoreTable th:nth-child(5),     /* H (hole points) */
#scoreTable td:nth-child(5) {
  width: 14% !important;
}

#scoreTable th:nth-child(6),     /* RUN */
#scoreTable td:nth-child(6),
#scoreTable th:nth-child(7),     /* TOT */
#scoreTable td:nth-child(7) {
  width: 17% !important;         /* gives RUN and TOT breathing room */
  font-weight: bold !important;
}

/* Mobile — even tighter if needed */
@media (max-width: 480px) {
  #scoreTable th, #scoreTable td {
    padding: 0.4rem 0.2rem !important;
    font-size: 0.9rem !important;
  }
  #scoreTable th:nth-child(1), td:nth-child(1) {
    font-size: 0.95rem !important;
  }
}

/* TOP NAV BUTTONS — BIGGER AND BOLDER (Prev / Next / Edit / Finish) */
#game > div:first-child > div > button {
  height: 46px !important;
  min-width: 80px !important;
  padding: 0 1rem !important;
  font-size: 1.05rem !important;
  font-weight: bold !important;
  border-radius: 12px !important;
}

/* CONTROL-BAR BUTTONS — ~30% SMALLER AND MORE SUBTLE */
.control-bar {
  padding: 0.4rem 0 !important;
  gap: 0.5rem !important;
  justify-content: center !important;
}

.control-bar button {
  min-width: 62px !important;     /* was ~90px → now ~30% smaller */
  height: 36px !important;        /* was 48px → now smaller */
  padding: 0 0.6rem !important;
  font-size: 0.78rem !important;  /* was 0.9rem */
  font-weight: bold !important;
  border-radius: 10px !important;
  background: #00bb00 !important; /* slightly darker so they recede */
}

/* HELP button stays on the right */
#bbbHelpBtn {
  margin-left: auto !important;
}




/* FINAL — HOLE & ROUND SUMMARIES: ALL RED, CLEAN, MATH VISIBLE */
.holeSummary,
#roundSummary {
  padding: 0.5rem 0.8rem !important;
  font-size: 0.9rem !important;
  line-height: 1.4 !important;
  text-align: center !important;
  color: #dc3545 !important;           /* everything red */
  background: #fff !important;
  border-radius: 12px !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  border: 1px solid #f8d7da;
}

/* Only the numbers are bold */
.holeSummary strong,
#roundSummary strong {
  font-weight: bold !important;
}

/* Expected line — smaller and shows the math */
#roundSummary small {
  display: block;
  font-size: 0.78rem !important;
  margin-top: 0.3rem !important;
  color: #a00 !important;
}


/* HOLE COLUMN NUMBERS — SAME STYLE AS TOT COLUMN */
#scoreTable td:nth-child(5) strong {   /* H column = 5th column */
  color: inherit !important;           /* same as TOT (black in light mode, white in dark) */
  font-weight: 600 !important;         /* same boldness as TOT */
  font-size: 1.1em !important;
}


#courseSetup.hidden { height:0 !important; overflow:hidden !important; padding:0 !important; margin:0 !important; }


</style>
</head>

<body>



 <!-- COURSE SETUP – BACKEND-DRIVEN (FINAL) -->
<section id="courseSetup" class="card center-block">
  <h2 style="text-align:center; color:var(--green); margin:1rem 0 0.5rem; font-size:1.6rem;">
    BBB Golf
  </h2>

  <div id="courseLoader" style="text-align:center; padding:2rem 1rem;">
    <div style="font-size:1rem; color:#666; margin-bottom:1rem;">Loading your courses...</div>
    <div style="width:48px; height:48px; border:5px solid #f0f0f0; border-top:5px solid var(--green); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto;"></div>
  </div>

  <div id="courseError" class="hidden" style="text-align:center; padding:1.5rem; color:#a00;">
    <p>Failed to load data from server.</p>
    <button id="retryBtn" style="background:var(--btn-bg); color:var(--btn-text); padding:0.8rem 1.6rem; font-size:1rem; margin:0.5rem;">
      Retry
    </button>
    <p style="font-size:0.9rem; color:#666; margin-top:1rem;">
      Check internet or wake the backend (it may be sleeping).
    </p>
  </div>

  <div id="coursePicker" class="hidden">
    <select id="courseSelect" style="width:100%; padding:0.9rem; font-size:1.2rem; margin-bottom:1rem; border-radius:8px; border:1px solid #aaa;">
      <option value="">– Select Course –</option>
    </select>
    <button id="nextToPlayers" disabled style="width:100%; padding:1.1rem; font-size:1.3rem; font-weight:bold;">
      Load Course →
    </button>
  </div>

  
</section>

 
  <!-- PLAYER SETUP -->
  <section id="playerSetup" class="card hidden center-block" role="region" aria-labelledby="playerSetupTitle">
    <h2 id="playerSetupTitle" class="hidden">Player Setup</h2>
    <button id="backToCourse">Back</button>
    <div id="playerSelect"></div>
    <div style="margin-top: 1rem; text-align: center;">
      <button id="startGame" disabled style="width: 100%; padding: 1rem; font-size: 1.1rem;">Start Round</button>
    </div>
  </section>

  <!-- ROSTER -->
  <section id="roster" class="card hidden center-block" role="region" aria-labelledby="rosterTitle">
    <h2 id="rosterTitle" class="hidden">Roster</h2>
    <button id="backToCourseFromRoster">Back</button>
    <input id="rosterName" placeholder="Name" style="width:100%;margin:0.5rem 0;" />
    <input id="rosterPhone" placeholder="Phone" style="width:100%;margin:0.5rem 0;" />
    <input id="rosterEmail" placeholder="Email" style="width:100%;margin:0.5rem 0;" />
    <button id="addToRoster">Add</button>
    <div id="rosterList"></div>
  </section>

  <!-- COURSE FORM -->
  <section id="courseForm" class="card hidden center-block" role="region" aria-labelledby="courseFormTitle">
    <h2 id="courseFormTitle" class="hidden">Add Course</h2>
    <button id="cancelCourse">Cancel</button>
    <input id="courseName" placeholder="Course Name" style="width:100%;margin:0.5rem 0;" />
    <div id="pars"></div>
    <button id="saveCourse">Save Course</button>
  </section>

  <!-- GAME SCREEN -->
  <section id="game" class="card hidden center-block" role="region" aria-labelledby="gameTitle">
    <h2 id="gameTitle" class="hidden">Game</h2>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;flex-wrap:wrap;">
      <h3 id="holeDisplay"></h3>
      <div>
        <button id="prevHole">Prev</button>
        <button id="nextHole">Next</button>
        <button id="editHole" class="hidden">Edit</button>
        <button id="finishHole">Finish Hole</button>
      </div>
    </div>

    <table id="scoreTable">
      <thead>
        <tr>
          <th>Player</th>
          <th id="firstOnHeader">FO</th>
          <th>CL</th>
          <th>P</th>
          <th>H</th>
          <th>RUN</th>
          <th>TOT</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="holeSummary"></div>
    <div id="roundSummary" class="hidden"></div>

   <div class="control-bar">
  <button id="sendSMS" title="Send live update to group">SMS</button>
  <button id="exportCSV" title="Download CSV">CSV</button>
  <button id="completeRound" title="Finish round & email Walt">BBB COMP</button>
  <button id="exitRound" title="Quit without saving">EXIT</button>
  <button id="darkModeToggle" title="Toggle dark mode">DARK</button>
  <button id="bbbHelpBtn" title="Open BBB Golf Help" style="margin-left:auto;">
    HELP
  </button>
</div>
  
  </section>

  <!-- SUMMARY -->
  <section id="summary" class="card hidden center-block" role="region" aria-labelledby="summaryTitle">
    <h2 id="summaryTitle" class="hidden">Summary</h2>
    <button id="backToSetup">Setup</button>
    <h3>Final Leaderboard</h3>
    <ol id="leaderboard"></ol>    
  </section>

  

  <!-- DEBUG -->
  <div id="debugPanel" class="card hidden" style="position:fixed;bottom:10px;right:10px;width:300px;max-height:80vh;overflow:auto;z-index:1000;">
    <button id="closeDebug" style="float:right;">Close</button>
    <h4>Carry Debug</h4>
    <div id="debugOutput"></div>
  </div>

  <div id="simResult"></div>

  

  <!-- COURSE + HOLE INFO BAR -->
  <div id="courseInfoBar" class="card center-block" style="margin: 0.5rem auto; padding: 0.75rem; font-size: 0.95rem; text-align: center; background: var(--card); border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); display: none;">
    <strong id="infoCourseName"></strong> — 
    Hole <span id="infoCurrentHole"></span> of 18
    <span id="infoPar" style="margin-left: 0.5rem; color: #0a6b0a;"></span>
  </div>

    <!-- BBB HELP MODAL -->
  <div id="bbbHelpModal" class="card hidden" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:400px;z-index:9999;max-height:80vh;overflow:auto;background:var(--card);border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);padding-top:env(safe-area-inset-top, 0px);">
    <div style="text-align:center;padding:0.75rem;border-bottom:1px solid #ddd;position:relative;">
      <h3 id="helpModalTitle" style="margin:0;color:var(--green);font-size:1.1rem;">BBB Help</h3>
      <button id="closeHelp" type="button" aria-label="Close help" style="position:absolute;top:8px;right:8px;background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--text);">×</button>
    </div>
    <div style="padding:1rem;display:grid;gap:1.5rem;font-size:0.9rem;">

      <!-- CONTROL BAR -->
      <div style="font-weight:bold;color:var(--green);margin-bottom:0.5rem;">Control Bar</div>
      <div>SMS – Send live update to the group</div>
      <div>CSV – Export scores to file</div>
      <div>BBB COMP – Complete the round</div>
      <div>EXIT – Quit current round</div>
      <div>DARK – Toggle dark mode</div>
      <div>HELP – You are here :)</div>

      <!-- SCORE TABLE -->
      <hr style="margin:1rem 0;border:0;border-top:1px solid #ddd;">
      <div style="font-weight:bold;color:var(--green);margin-bottom:0.5rem;">Score Table</div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">FO</span>
        <div><strong>FO</strong> – First On</div>
      </div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">CL</span>
        <div><strong>CL</strong> – Closest to pin</div>
      </div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">P</span>
        <div><strong>P</strong> – Putts</div>
      </div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">H</span>
        <div><strong>H</strong> – Points this hole</div>
      </div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">RUN</span>
        <div><strong>RUN</strong> – Running total</div>
      </div>
      <div style="display:flex;align-items:center;gap:1.5rem;">
        <span style="width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:0.8rem;color:#000;background:#0f0;border-radius:4px;">TOT</span>
        <div><strong>TOT</strong> – Final total</div>
      </div>

    </div>
  </div> 

  <!-- BACKDROP -->
  <div id="bbbHelpBackdrop" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9998;" aria-hidden="true"></div>


   <!-- SERVICE WORKER -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('SW registered', reg))
          .catch(err => console.log('SW failed', err));
      });
    }
  </script>

  <!-- APP JS -->
  <script src="app-v23.js?v=20251124"></script>

  <div id="versionWatermark" style="position:fixed;bottom:8px;left:8px;font-size:10px;color:#666;background:rgba(255,255,255,0.85);padding:2px 6px;border-radius:4px;z-index:100;pointer-events:none;opacity:0.8;">
  v<script>document.write(VERSION)</script>
</div>

    <!-- MODAL JS (DOM READY) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('bbbHelpModal');
      const backdrop = document.getElementById('bbbHelpBackdrop');
      if (modal) modal.classList.add('hidden');
      if (backdrop) backdrop.classList.add('hidden');

      const helpBtn = document.getElementById('bbbHelpBtn');
      const closeBtn = document.getElementById('closeHelp');

      if (!helpBtn || !modal || !backdrop || !closeBtn) return;

      const openModal = () => {
        modal.classList.remove('hidden');
        backdrop.classList.remove('hidden');
        modal.setAttribute('aria-hidden', 'false');
        backdrop.setAttribute('aria-hidden', 'false');
      };

      const closeModal = () => {
        modal.classList.add('hidden');
        backdrop.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
        backdrop.setAttribute('aria-hidden', 'true');
      };

      helpBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      backdrop.addEventListener('click', closeModal);
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal();
      });
    });
  </script>
 </body>
</html>